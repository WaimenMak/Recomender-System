<!DOCTYPE html>
<html>

<head>
  <title>Assignment 2</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='/stylesheets/style.css' />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>

<body>
  <!-- Loading the charts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>

    var algo1Chart
    var algo2Chart
    var round1Algo1Chart
    var round1Algo2Chart
    var round2Algo1Chart
    var round2Algo2Chart
    document.addEventListener("DOMContentLoaded", function () {


      // Algo 1 Chart___________________________
      const label = []

      const data = {
        labels: label,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config = {
        type: 'line',
        data: data,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Factorization Algorithm (Algo1)',
              padding: 20
            },
            legend: {
              display: false
            },
          },

        },
      };


      algo1Chart = new Chart(
        document.getElementById('algo1Chart'),
        config
      )

      // Algo 2 Chart _______________________________________________________________________
      const label2 = []

      const data2 = {
        labels: label2,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config2 = {
        type: 'line',
        data: data2,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Content-Based-Algoritm-Rating (Algorithm 2) ',
              padding: 20
            },
            legend: {
              display: false
            }
          },

        },
      };


      algo2Chart = new Chart(
        document.getElementById('algo2Chart'),
        config2
      )


      // Algo 1 Round 1 Chart _________________________
      const label3 = []

      const data3 = {
        labels: label3,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config3 = {
        type: 'line',
        data: data3,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Round 1 Factorization Algorithm Results',
              padding: 20
            },
            legend: {
              display: false
            }
          },

        },
      };


      round1Algo1Chart = new Chart(
        document.getElementById('round1Algo1Chart'),
        config3
      )

      // Round 2 Algo 1 ______________________________
      const label4 = []

      const data4 = {
        labels: label4,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config4 = {
        type: 'line',
        data: data4,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Round 2 Factorization Algorithm Results',
              padding: 20
            },
            legend: {
              display: false
            }
          },

        },
      };


      round2Algo1Chart = new Chart(
        document.getElementById('round2Algo1Chart'),
        config4
      )


      //Round 1 Algo 2 Chart 
      const label5 = []

      const data5 = {
        labels: label3,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config5 = {
        type: 'line',
        data: data5,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Round 1 Content-based algorithm',
              padding: 20
            },
            legend: {
              display: false
            }
          },

        },
      };


      round1Algo2Chart = new Chart(
        document.getElementById('round1Algo2Chart'),
        config5
      )



      // Round1 Algo 2 Chart 

      const label6 = []

      const data6 = {
        labels: label4,
        datasets: [{
          //label: 'My Second Data Set',
          data: [],
          backgroundColor: [
            '#485fc7',
          ],
          borderColor: [
            '#485fc7',
          ],
          borderWidth: 1
        }],
      };

      const config6 = {
        type: 'line',
        data: data4,
        options: {
          scales: {
            x: {

              title: {
                display: true,
                text: "User",
                font: function (context) {
                  var width = context.chart.width;
                  var size = Math.round(width / 48);
                  return {
                    size: size,
                    weight: 600
                  };
                },
                padding: 20
              },

              ticks: {
                font: {

                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
              }
            },

            y: {
              title: {
                display: true,
                text: "Average Rating",

                padding: 20
              },

              ticks: {
                font: {
                  size: function (context) {
                    var width = context.chart.width;
                    var size = Math.round(width / 48);
                    return size;
                  },
                },
                stepSize: 1
              }

            },
          },
          plugins: {
            title: {
              display: true,
              text: 'Round 2 content-based algorithm results',
              padding: 20
            },
            legend: {
              display: false
            }
          },

        },
      };


      round2Algo2Chart = new Chart(
        document.getElementById('round2Algo2Chart'),
        config6
      )
    })
  </script>
  <!-- <script src="/javascripts/barchartVacation.js"></script>
  <script src="/javascripts/timeSeries.js"></script>
  <script src="/javascripts/piechartGender.js"></script> -->
  <!-- Actual Website Starts -->
  <section class="section">
    <section>
      <div class="container">
        <div class="tile is-ancestor">
          <div class="tile is-6 is-parent is-vertical">
            <div class="tile is-child box">
              <canvas id="algo1Chart"></canvas>
            </div>
            <div class="tile is-child box">
              <canvas id="round1Algo1Chart"></canvas>
            </div>
            <div class="tile is-child box">
              <canvas id="round2Algo1Chart"></canvas>
            </div>
          </div>
          <div class="tile is-6 is-parent is-vertical">
            <div class="tile is-child box">
              <canvas id="algo2Chart"></canvas>
            </div>
            <div class="tile is-child box">
              <canvas id="round1Algo2Chart"></canvas>
            </div>
            <div class="tile is-child box">
              <canvas id="round2Algo2Chart"></canvas>
            </div>
          </div>
        </div>
    </section>
    <section>

      <div class="container">

        <div class="tile is-child box">
          <table class="table is-bordered">
            <thead>
              <th>Type</th>
              <th>Result</th>
            </thead>
            <tbody>
              <tr>
                <td>T-Test: Within Algorithm - Statistik </td>
                <td id="within_algo_statistic"></td>
              </tr>
              <tr>
                <td>T-Test: Within Algorithm - P-Value </td>
                <td id="within_algo_p_value"></td>
              </tr>
              <tr>
                <td>T-Test Factorization Algorihtm: Within Rounds - Statistik </td>
                <td id="within_rounds_algo1_statistic"></td>
              </tr>
              <tr>
                <td>T-Test Factorization Algorithm: Within Rounds - P-Value </td>
                <td id="within_rounds_algo1_p_value"></td>
              </tr>
              <tr>
                <td>T-Test Content-based Algorihtm: Within Rounds - Statistik </td>
                <td id="within_rounds_algo2_statistic"></td>
              </tr>
              <tr>
                <td>T-Test Content-based Algorithm: Within Rounds - P-Value </td>
                <td id="within_rounds_algo2_p_value"></td>
              </tr>
            </tbody>


          </table>

        </div>
      </div>
    </section>
    </div>
</body>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
  //Measuring the time from start to end it takes for the user to complete the survey
  var startTime;
  var endTime;


  function updateChart(chart, labelList, dataList) {
    console.log(chart)
    chart.data.labels = labelList;

    chart.data.datasets.forEach((dataset) => {
      dataset.data = dataList;
    });
    chart.update();

  }

  var data;
  async function updateStatistics() {
    var response = axios.get("http://127.0.0.1:8000/api/ttest").then((res) => {
      this.data = res.data;





      var algo1_results = data.algo1_results;
      var algo2_results = data.algo2_results;
      var firstround_results_algo1 = data.firstround_results_algo1;
      var secondround_results_algo1 = data.secondround_results_algo1;

      var firstround_results_algo2 = data.firstround_results_algo2;
      var secondround_results_algo2 = data.secondround_results_algo2;

      // Display this data on the website 
      var t_test_within_algo_statistic = data.t_test_within_algo_statistic
      var t_test_within_algo_p_value = data.t_test_within_algo_p_value
      var t_test_within_rounds_algo1_statistic = data.t_test_within_rounds_algo1_statistic
      var t_test_within_rounds_algo1_p_value = data.t_test_within_rounds_algo1_p_value
      var t_test_within_rounds_algo2_statistic = data.t_test_within_rounds_algo2_statistic
      var t_test_within_rounds_algo2_p_value = data.t_test_within_rounds_algo2_p_value

      document.getElementById("within_algo_statistic").innerHTML = t_test_within_algo_statistic;
      document.getElementById("within_algo_p_value").innerHTML = t_test_within_algo_p_value;
      document.getElementById("within_rounds_algo1_statistic").innerHTML = t_test_within_rounds_algo1_statistic;
      document.getElementById("within_rounds_algo1_p_value").innerHTML = t_test_within_rounds_algo1_p_value;
      document.getElementById("within_rounds_algo2_statistic").innerHTML = t_test_within_rounds_algo2_statistic;
      document.getElementById("within_rounds_algo2_p_value").innerHTML = t_test_within_rounds_algo2_p_value;
      // var genderResults = data.genderResult;
      // var vacationResults = data.vacationResult;
      console.log(data)

      algo1_results_keys = [...Array(algo1_results.length).keys()];
      algo1_results_values = Object.values(data.algo1_results);

      algo2_results_keys = [...Array(algo2_results.length).keys()];
      algo2_results_values = Object.values(data.algo2_results);

      firstround_results_algo1_keys = [...Array(firstround_results_algo1.length).keys()];
      firstround_results_algo1_values = Object.values(data.firstround_results_algo1);

      secondround_results_algo1_keys = [...Array(secondround_results_algo1.length).keys()];
      secondround_results_algo1_values = Object.values(data.secondround_results_algo1);

      firstround_results_algo2_keys = [...Array(firstround_results_algo2.length).keys()];
      firstround_results_algo2_values = Object.values(data.firstround_results_algo2);

      secondround_results_algo2_keys = [...Array(secondround_results_algo2.length).keys()];
      secondround_results_algo2_values = Object.values(data.secondround_results_algo2);

      updateChart(algo1Chart, algo1_results_keys, algo1_results_values)
      updateChart(algo2Chart, algo2_results_keys, algo2_results_values)
      updateChart(round1Algo1Chart, firstround_results_algo1_keys, firstround_results_algo1_values)
      updateChart(round2Algo1Chart, secondround_results_algo1_keys, secondround_results_algo1_values)
      updateChart(round1Algo2Chart, firstround_results_algo2_keys, firstround_results_algo2_values)
      updateChart(round2Algo2Chart, secondround_results_algo2_keys, secondround_results_algo2_values)

    });

  }

  document.addEventListener("DOMContentLoaded", function () {

    startTime = performance.now()

    updateStatistics();
  });

</script>

</html>